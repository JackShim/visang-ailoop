<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Visang Market</title>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@100..900&display=swap" rel="stylesheet">
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>
    <style>
        /*
        * ë””ìì¸ ê°€ì´ë“œ ë°˜ì˜
        * Main: #00b5e2 (Cyan), Sub: #6a71f6 (Violet)
        * Base: #FFFFFF (ë°°ê²½), #2b2b2b (ë³¸ë¬¸)
        * Font: Noto Sans KR
        */
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: 'Noto Sans KR', sans-serif;
            background: #FFFFFF; /* ë°°ê²½ìƒ‰ */
            min-height: 100vh;
            color: #2b2b2b; /* ë³¸ë¬¸ìƒ‰ */
            position: relative;
            line-height: 1.6;
        }
        /* Background Orbs Animation (Cyan/Violet ê·¸ë¼ë°ì´ì…˜ì˜ 3D ì¶”ìƒ í˜•íƒœ) */
        .bg-orbs {
            position: fixed;
            inset: 0;
            overflow: hidden;
            pointer-events: none;
            z-index: 0;
            opacity: 0.5;
        }
        .bg-orb {
            position: absolute;
            border-radius: 50%;
            mix-blend-mode: multiply;
            filter: blur(80px);
            opacity: 0.3;
        }
        .bg-orb-1 {
            top: 5rem;
            left: 5rem;
            width: 24rem;
            height: 24rem;
            background: #00b5e2; /* Main Color */
            animation: blob 7s infinite;
        }
        .bg-orb-2 {
            top: 10rem;
            right: 5rem;
            width: 24rem;
            height: 24rem;
            background: #6a71f6; /* Sub Color */
            animation: blob 7s infinite;
            animation-delay: 2s;
        }
        .bg-orb-3 {
            bottom: 5rem;
            left: 50%;
            transform: translateX(-50%);
            width: 24rem;
            height: 24rem;
            background: #00b5e2; /* Main Color */
            animation: blob 7s infinite;
            animation-delay: 4s;
        }
        @keyframes blob {
            0%, 100% { transform: translate(0, 0) scale(1); }
            33% { transform: translate(30px, -50px) scale(1.1); }
            66% { transform: translate(-20px, 20px) scale(0.9); }
        }
        .container { max-width: 1280px; margin: 0 auto; padding: 0 1rem; position: relative; z-index: 1; }
        header {
            position: relative;
            backdrop-filter: blur(12px);
            background: rgba(255, 255, 255, 0.7);
            border-bottom: 1px solid rgba(255, 255, 255, 0.2);
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.05);
            position: sticky;
            top: 0;
            z-index: 50;
        }
        .header-content {
            max-width: 1280px;
            margin: 0 auto;
            padding: 1rem 1.5rem;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }
        .logo {
            font-size: 1.5rem;
            font-weight: 700;
            /* Main/Sub Gradient */
            background: linear-gradient(to right, #00b5e2, #6a71f6);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            cursor: pointer;
            transition: opacity 0.2s;
        }
        .logo:hover { opacity: 0.8; }
        
        /* Typography Sizes (Hero: 64px, Title: 28px, Body: 18px) */
        .hero-title { font-size: 4rem; font-weight: 900; } /* 64px */
        h1 { font-size: 1.75rem; font-weight: 700; } /* 28px */
        h2 { font-size: 1.75rem; font-weight: 700; } /* 28px */
        .body-text { font-size: 1.125rem; } /* 18px */

        .btn {
            padding: 0.75rem 1.5rem; /* ë²„íŠ¼ íŒ¨ë”© ì¡°ì • */
            border-radius: 0.75rem; /* ë‘¥ê·¼ ëª¨ì„œë¦¬ */
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s;
            border: none;
            text-decoration: none;
            display: inline-block;
            font-size: 1rem;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1); /* ë¶€ë“œëŸ¬ìš´ ê·¸ë¦¼ì */
        }
        .btn-primary {
            /* Main/Sub Gradient */
            background: linear-gradient(to right, #00b5e2, #6a71f6);
            color: white;
        }
        .btn-primary:hover {
            box-shadow: 0 10px 15px rgba(0, 0, 0, 0.15);
            transform: translateY(-2px);
        }
        .btn-secondary {
            background: rgba(255, 255, 255, 0.8);
            color: #2b2b2b;
            border: 1px solid #e5e7eb;
        }
        .btn-secondary:hover { background: rgba(255, 255, 255, 0.95); }

        .card {
            backdrop-filter: blur(12px);
            background: rgba(255, 255, 255, 0.8); /* Glassmorphism */
            border-radius: 1rem;
            padding: 1.5rem;
            border: 1px solid rgba(255, 255, 255, 0.3);
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.05); /* ë¶€ë“œëŸ¬ìš´ ê·¸ë¦¼ì */
        }
        .grid {
            display: grid;
            gap: 1.5rem;
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
        }
        @media (max-width: 768px) {
            .grid { grid-template-columns: 1fr; }
            .header-content { flex-wrap: wrap; gap: 0.5rem; }
            .hero-title { font-size: 3rem; }
        }
        /* Input & Select Styles (Minimalist, Clean) */
        input, textarea, select {
            width: 100%;
            padding: 0.75rem 1rem;
            border: 1px solid #e5e7eb;
            border-radius: 0.75rem;
            background: rgba(255, 255, 255, 0.8);
            font-size: 1rem;
            transition: all 0.2s;
            font-family: 'Noto Sans KR', sans-serif;
            color: #2b2b2b;
        }
        input:focus, textarea:focus, select:focus {
            outline: none;
            border-color: #00b5e2; /* Main Color Focus */
            box-shadow: 0 0 0 3px rgba(0, 181, 226, 0.1);
        }
        
        /* ê²€ìƒ‰ ì•„ì´ì½˜ Wrapper ìŠ¤íƒ€ì¼ ìˆ˜ì • */
        .search-input-wrapper {
            position: relative;
        }
        .search-input-wrapper .search-icon {
            position: absolute;
            left: 1rem;
            top: 50%;
            transform: translateY(-50%);
            width: 1.25rem;
            height: 1.25rem;
            color: #9ca3af;
        }
        .search-input-wrapper input.search-input {
            padding-left: 3rem; /* ê²€ìƒ‰ ì•„ì´ì½˜ ê³µê°„ í™•ë³´ */
        }
        
        /* ë©”ë‰´ ìŠ¤íƒ€ì¼ */
        .category-menu {
            display: flex;
            gap: 0;
            padding: 0;
            margin: 0;
            border-radius: 0.75rem;
            border: 1px solid #e5e7eb;
            background: rgba(255, 255, 255, 0.9);
            overflow: hidden;
            justify-content: center;
        }
        .menu-item {
            flex: 1;
            padding: 0.75rem 1rem;
            font-weight: 500;
            transition: all 0.2s;
            white-space: nowrap;
            border: none;
            background: transparent;
            color: #2b2b2b;
            cursor: pointer;
            text-align: center;
            border-right: 1px solid #e5e7eb;
        }
        .menu-item:last-child {
            border-right: none;
        }
        .menu-item:hover {
            background: rgba(0, 181, 226, 0.05);
        }
        .menu-item.active {
            /* Main/Sub Gradient Active */
            background: linear-gradient(to right, #00b5e2, #6a71f6);
            color: white;
            font-weight: 700;
            border-color: transparent;
            box-shadow: none;
        }

        .tool-card {
            backdrop-filter: blur(12px);
            background: rgba(255, 255, 255, 0.8);
            border-radius: 1rem;
            padding: 1.5rem;
            border: 1px solid rgba(255, 255, 255, 0.3);
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.05);
            transition: all 0.3s;
            cursor: pointer;
        }
        .tool-card:hover {
            box-shadow: 0 15px 25px rgba(0, 0, 0, 0.1);
            transform: translateY(-5px); /* ë¶€ë“œëŸ¬ìš´ ì›€ì§ì„ */
        }
        
        .badge {
            display: inline-block;
            padding: 0.25rem 0.75rem;
            border-radius: 9999px;
            font-size: 0.75rem;
            font-weight: 600;
            color: white;
        }
        .badge-type {
            background: #6a71f6; /* Sub Color for type */
        }
        .badge-subject {
            background: #00b5e2; /* Main Color for subject */
        }
        
        /* ê¸°ì¡´ ì¢‹ì•„ìš” ë²„íŠ¼ ìŠ¤íƒ€ì¼ ìœ ì§€ */
        .like-btn-card:hover { color: #ef4444 !important; }
        .like-btn-detail:hover { color: #ef4444 !important; }

        .toast {
            position: fixed;
            bottom: 2rem;
            right: 2rem;
            background: #2b2b2b;
            color: white;
            padding: 1rem 1.5rem;
            border-radius: 0.5rem;
            box-shadow: 0 10px 15px rgba(0, 0, 0, 0.2);
            z-index: 1000;
            animation: slideIn 0.3s;
            font-size: 1rem;
        }
        @keyframes slideIn {
            from { transform: translateX(100%); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }
        .hidden { display: none; }
        .page { display: none; }
        .page.active { display: block; }
    </style>
</head>
<body>
    <div class="bg-orbs">
        <div class="bg-orb bg-orb-1"></div>
        <div class="bg-orb bg-orb-2"></div>
        <div class="bg-orb bg-orb-3"></div>
    </div>
    <div id="app"></div>
    <script>
        // **Firebase ì—°ê²° ì£¼ì„ ì²˜ë¦¬ ë° ë¡œì»¬ ë°ì´í„° ì‚¬ìš© (ë‹¨ì¼ HTML íŒŒì¼ ìš”êµ¬ì‚¬í•­ ì¤€ìˆ˜)**
        let db = null;
        /*
        try {
            const firebaseConfig = { ... }; // ì‹¤ì œ í‚¤ëŠ” ìƒëµ
            firebase.initializeApp(firebaseConfig);
            db = firebase.firestore();
        } catch (e) {
            console.warn('Firebase ì´ˆê¸°í™” ìƒëµ');
            db = null;
        }
        */

        // Level 1: ê³¼ëª© ì¹´í…Œê³ ë¦¬ (ê³¼ëª©ë³„ ë¸Œëœë“œ ë³´ê¸° ë©”ë‰´ ì‚­ì œë¨)
        const categories = ["ì „ì²´", "ì˜ì–´", "êµ­ì–´", "ìˆ˜í•™"];
        
        // Level 2: ë¬¸ì œ ìœ í˜•
        const problemTypes = ["ê°ê´€ì‹", "ì£¼ê´€ì‹", "í¼ì¦í˜•", "ë“£ê¸° í‰ê°€", "ì„œìˆ í˜•", "ê¸°íƒ€"];

        // Level 3/4: êµìœ¡ ì½˜í…ì¸  ê°œë°œ ë°©ì‹ ë°ì´í„° (ê¸°ì¡´ defaultToolsë¥¼ ëŒ€ì²´)
        const contentMethods = [
            {
                id: 1, title: "AI ê¸°ë°˜ ê°ê´€ì‹ í€´ì¦ˆ ìƒì„± í”„ë¡¬í”„íŠ¸",
                description: "ì£¼ìš” í‚¤ì›Œë“œë¥¼ ì…ë ¥í•˜ë©´ ë‚œì´ë„ë³„ ê°ê´€ì‹ ë¬¸ì œ 5ê°œë¥¼ ì¦‰ì‹œ ìƒì„±í•©ë‹ˆë‹¤.",
                longDescription: "ì§§ì€ ì‹œê°„ ì•ˆì— ë‚œì´ë„ì™€ ìœ í˜•ì´ ë³´ì¥ëœ ê°ê´€ì‹ ë¬¸ì œë¥¼ ëŒ€ëŸ‰ìœ¼ë¡œ ë§Œë“¤ì–´ì•¼ í•  ë•Œ ìœ ìš©í•©ë‹ˆë‹¤. íŠ¹íˆ ê°œë… í™•ì¸ì´ë‚˜ ë¹ ë¥¸ ë³µìŠµì„ ìœ„í•œ í€´ì¦ˆ ì œì‘ì— ìµœì í™”ë˜ì–´ ìˆìŠµë‹ˆë‹¤. ì´ ê°œë°œ ë°©ì‹ì€ ìˆ˜ë§ì€ í…ŒìŠ¤íŠ¸ì™€ í”¼ë“œë°±ì„ í†µí•´ ìµœì í™”ëœ AI í”„ë¡¬í”„íŠ¸ ì—”ì§€ë‹ˆì–´ë§ ê²°ê³¼ë¥¼ ê³µìœ í•©ë‹ˆë‹¤.",
                category: "ì˜ì–´", // Level 1 Subject
                level2Type: "ê°ê´€ì‹", // Level 2 Problem Type
                productionMethod: "AI / í”„ë¡¬í”„íŠ¸ ì—”ì§€ë‹ˆì–´ë§", // ì œì‘ ë°©ì‹
                requiredResource: "í‚¤ì›Œë“œ ë¦¬ìŠ¤íŠ¸, í…ìŠ¤íŠ¸ ì§€ë¬¸ (ì„ íƒ)", // í•„ìš” ë¦¬ì†ŒìŠ¤
                timeSpent: "5ë¶„ ì´ë‚´", // ì œì‘ ì†Œìš” ì‹œê°„
                recommendedSubject: "ì˜ì–´, êµ­ì–´, ì‚¬íšŒ", // ì ìš©í•˜ë©´ ì¢‹ì„ ê³¼ëª©
                coinPrice: 1500, // ì½”ì¸ ê±°ë˜ ê°€ê²©
                aiModel: "GPT-4", type: "í”„ë¡¬í”„íŠ¸",
                likes: 245, views: 1820, comments: 32, createdAt: "2024-01-15",
            },
            {
                id: 2, title: "ë…¼ë¦¬ì  ì‚¬ê³  ì„œìˆ í˜• ì‹¬í™” ê°œë°œ ë°©ì‹",
                description: "ì‹¬í™” í•™ìŠµì„ ìœ„í•œ ë…¼ë¦¬ì  ì‚¬ê³  ê¸°ë°˜ì˜ ì„œìˆ í˜• ë¬¸ì œë¥¼ ë§Œë“œëŠ” ì²´ê³„ì ì¸ ê°€ì´ë“œì…ë‹ˆë‹¤.",
                longDescription: "ë‹¨ìˆœ ì•”ê¸°ê°€ ì•„ë‹Œ, í•™ìƒë“¤ì˜ ë…¼ë¦¬ì  ì‚¬ê³ ë ¥ê³¼ ë¬¸ì œ í•´ê²° ëŠ¥ë ¥ì„ í‰ê°€í•  ìˆ˜ ìˆëŠ” ê³ í’ˆì§ˆ ì„œìˆ í˜• ë¬¸ì œë¥¼ ê°œë°œí•˜ëŠ” ë°©ë²•ë¡ ì„ ê³µìœ í•©ë‹ˆë‹¤. ë³µì¡í•œ ì±„ì  ê¸°ì¤€í‘œ(Rubric) ì œì‘ ë°©ì‹ê³¼ ì˜ˆì‹œê°€ í¬í•¨ë˜ì–´ ìˆìŠµë‹ˆë‹¤.",
                category: "êµ­ì–´",
                level2Type: "ì„œìˆ í˜•",
                productionMethod: "CMS / ì „ë¬¸ê°€ ì¸ë ¥",
                requiredResource: "ì¥ë¬¸ ì§€ë¬¸, ë¬¸ë²• ê·œì¹™ ìë£Œ, ì±„ì  ê¸°ì¤€í‘œ ì›ë³¸",
                timeSpent: "30ë¶„ ~ 1ì‹œê°„",
                recommendedSubject: "êµ­ì–´, ì‚¬íšŒ, ê³¼í•™",
                coinPrice: 3500,
                aiModel: "ì¸ê°„ ì „ë¬¸ê°€ ê¸°ë°˜", type: "ê°œë°œ ë°©ì‹",
                likes: 312, views: 2150, comments: 24, createdAt: "2024-01-18",
            },
            {
                id: 3, title: "ì¸í„°ë™í‹°ë¸Œ í¼ì¦í˜• ì›¹ ì½˜í…ì¸  ì œì‘ ê°€ì´ë“œ",
                description: "í•™ìŠµ ë‚´ìš©ì„ ê¸°ë°˜ìœ¼ë¡œ í•œ ë“œë˜ê·¸&ë“œë¡­ í¼ì¦ì„ ì›¹ ê¸°ë°˜ìœ¼ë¡œ ë¹ ë¥´ê²Œ ì œì‘í•˜ëŠ” ê¸°ìˆ  ê³µìœ ì…ë‹ˆë‹¤.",
                longDescription: "ìˆ˜í•™ ê³µì‹ ì•”ê¸°ë‚˜ ì˜ì–´ ë‹¨ì–´ ë§¤ì¹­ ë“± ì§€ë£¨í•  ìˆ˜ ìˆëŠ” í•™ìŠµ ë‚´ìš©ì„ ê²Œì„ ìš”ì†Œ(Gamification)ë¥¼ ê°€ë¯¸í•˜ì—¬ ì¬ë¯¸ìˆê²Œ ì œì‘í•  ìˆ˜ ìˆëŠ” ê¸°ìˆ  ê³µìœ ì…ë‹ˆë‹¤. ì›¹ í‘œì¤€ ê¸°ìˆ (HTML/CSS/JS)ë§Œì„ ì‚¬ìš©í•˜ì—¬ ì½”ë”© êµìœ¡ì—ë„ í™œìš© ê°€ëŠ¥í•©ë‹ˆë‹¤.",
                category: "ìˆ˜í•™",
                level2Type: "í¼ì¦í˜•",
                productionMethod: "ì›¹ (HTML5, JS)",
                requiredResource: "ì´ë¯¸ì§€ ì—ì…‹ (ì•„ì´ì½˜ ë“±), JS ë¼ì´ë¸ŒëŸ¬ë¦¬ (ì„ íƒ)",
                timeSpent: "2ì‹œê°„ ~ 4ì‹œê°„",
                recommendedSubject: "ìˆ˜í•™, ì˜ì–´, ê¸°íƒ€ ì˜ˆì²´ëŠ¥",
                coinPrice: 5000,
                aiModel: "None", type: "ê°œë°œ ë°©ì‹",
                likes: 428, views: 3240, comments: 45, createdAt: "2024-01-20",
            },
            {
                id: 4, title: "ì›ì–´ë¯¼ ë“£ê¸° í‰ê°€ ìŒì› ì œì‘ ê°€ì´ë“œ",
                description: "í•©ì„± ìŒì„±ì´ ì•„ë‹Œ ìì—°ìŠ¤ëŸ¬ìš´ ì›ì–´ë¯¼ ìŒì„±ì„ ë‚®ì€ ë¹„ìš©ìœ¼ë¡œ ë…¹ìŒí•˜ì—¬ í¸ì§‘í•˜ëŠ” ë…¸í•˜ìš°ë¥¼ ì œê³µí•©ë‹ˆë‹¤.",
                longDescription: "ë“£ê¸° í‰ê°€ ë¬¸ì œì˜ í’ˆì§ˆì„ ì¢Œìš°í•˜ëŠ” ìŒì› ì œì‘ ê³¼ì •ì„ ìµœì í™”í•©ë‹ˆë‹¤. ì „ë¬¸ ìŠ¤íŠœë””ì˜¤ ëŒ€ì‹  ì €ë¹„ìš© ê³ íš¨ìœ¨ í™ˆ ìŠ¤íŠœë””ì˜¤ í™˜ê²½ êµ¬ì¶• ë° í€„ë¦¬í‹° ì»¨íŠ¸ë¡¤ ë…¸í•˜ìš°ê°€ í•µì‹¬ì…ë‹ˆë‹¤.",
                category: "ì˜ì–´",
                level2Type: "ë“£ê¸° í‰ê°€",
                productionMethod: "í™ˆ ìŠ¤íŠœë””ì˜¤ / ì˜¤ë””ì˜¤ í¸ì§‘ ê¸°ìˆ ",
                requiredResource: "ë…¹ìŒ ì¥ë¹„, ìŠ¤í¬ë¦½íŠ¸",
                timeSpent: "1ì‹œê°„ ~ 2ì‹œê°„",
                recommendedSubject: "ì˜ì–´, ì™¸êµ­ì–´",
                coinPrice: 4000,
                aiModel: "None", type: "ê°œë°œ ë°©ì‹",
                likes: 567, views: 4120, comments: 56, createdAt: "2024-01-22",
            }
        ];
        
        // ìƒíƒœ ê´€ë¦¬
        let state = {
            currentPage: 'home',
            currentToolId: null,
            tools: contentMethods, // ê¸°ë³¸ ë°ì´í„°ë¡œ ì„¤ì •
            filteredTools: [],
            selectedCategory: 'ì „ì²´',
            searchQuery: '',
            sortBy: 'ì¸ê¸°ìˆœ',
            currentPageNum: 1,
            likedTools: new Set(),
            isLoading: false,
            ITEMS_PER_PAGE: 12,
            selectedSubMenu: 'ìœ í˜• ë³´ê¸°', // [NEW] í•˜ìœ„ ë©”ë‰´ ìƒíƒœ
        };

        // ìœ í‹¸ë¦¬í‹° í•¨ìˆ˜
        function filterAndSortTools(tools, filters) {
            let filtered = [...tools];
            if (filters.category && filters.category !== "ì „ì²´") {
                filtered = filtered.filter(t => t.category === filters.category);
            }
            // ê²€ìƒ‰ì€ ì œëª©, ì„¤ëª…, ê³¼ëª©(category), ë¬¸ì œ ìœ í˜•(level2Type), ì œì‘ ë°©ì‹(productionMethod) í¬í•¨
            if (filters.searchQuery && filters.searchQuery.trim()) {
                const query = filters.searchQuery.toLowerCase().trim();
                filtered = filtered.filter(t =>
                    t.title.toLowerCase().includes(query) ||
                    t.description.toLowerCase().includes(query) ||
                    t.category.toLowerCase().includes(query) ||
                    t.level2Type.toLowerCase().includes(query) ||
                    (t.productionMethod && t.productionMethod.toLowerCase().includes(query)) ||
                    (t.recommendedSubject && t.recommendedSubject.toLowerCase().includes(query))
                );
            }
            // ì •ë ¬ ë¡œì§ (ê¸°ì¡´ í…œí”Œë¦¿ ë¡œì§ ìœ ì§€)
            filtered.sort((a, b) => b.likes - a.likes);
            return filtered;
        }
        
        function paginateTools(tools, page, itemsPerPage) {
            const start = (page - 1) * itemsPerPage;
            return tools.slice(start, start + itemsPerPage);
        }
        
        function getTotalPages(totalItems, itemsPerPage) {
            return Math.ceil(totalItems / itemsPerPage);
        }
        
        // Toast ì•Œë¦¼ (ì½”ì¸ ê±°ë˜/ì±„íŒ… ì‹œë®¬ë ˆì´ì…˜ìš©)
        function showToast(title, description, variant = 'default') {
            const toast = document.createElement('div');
            toast.className = 'toast';
            if (variant === 'success') {
                toast.style.background = '#6a71f6'; // Sub Color
            } else if (variant === 'info') {
                toast.style.background = '#00b5e2'; // Main Color
            }
            toast.innerHTML = `<strong>${title}</strong><br>${description}`;
            document.body.appendChild(toast);
            setTimeout(() => toast.remove(), 3000);
        }
        
        // í˜ì´ì§€ ì´ë™ í•¨ìˆ˜
        function navigate(page, toolId = null) {
            state.currentPage = page;
            state.currentToolId = toolId;
            // ìƒì„¸ í˜ì´ì§€ ì´ë™ ì‹œ ì¢‹ì•„ìš” ìƒíƒœë¥¼ localStorageì—ì„œ ë¶ˆëŸ¬ì˜´
            if (page === 'detail' && toolId) {
                const storedLikes = localStorage.getItem('likedTools');
                if (storedLikes) {
                    try { state.likedTools = new Set(JSON.parse(storedLikes)); } catch (e) {}
                }
            }
            render();
            // ìƒì„¸ í˜ì´ì§€ì¼ ê²½ìš° ìŠ¤í¬ë¡¤ ìƒë‹¨ìœ¼ë¡œ ì´ë™
            if (page === 'detail') { window.scrollTo({ top: 0, behavior: 'smooth' }); }
        }

        // ì¹´í…Œê³ ë¦¬ ì„¤ì • (Level 1 ë©”ë‰´)
        function setCategory(category) {
            state.selectedCategory = category;
            state.searchQuery = ''; // ì¹´í…Œê³ ë¦¬ ë³€ê²½ ì‹œ ê²€ìƒ‰ ì´ˆê¸°í™”
            state.currentPageNum = 1;
            state.selectedSubMenu = 'ìœ í˜• ë³´ê¸°'; // [NEW] ë©”ì¸ ì¹´í…Œê³ ë¦¬ ë³€ê²½ ì‹œ í•˜ìœ„ ë©”ë‰´ëŠ” 'ìœ í˜• ë³´ê¸°'ë¡œ ì´ˆê¸°í™”
            render();
        }

        // [NEW] í•˜ìœ„ ë©”ë‰´ ì„¤ì •
        function setSubMenu(subMenu) {
            state.selectedSubMenu = subMenu;
            state.currentPageNum = 1;
            render();
        }
        
        // í˜ì´ì§€ ë³€ê²½
        function changePage(pageNum) {
            if (pageNum < 1 || pageNum > getTotalPages(filterAndSortTools(state.tools, state).length, state.ITEMS_PER_PAGE)) return;
            state.currentPageNum = pageNum;
            render();
            window.scrollTo({ top: 0, behavior: 'smooth' });
        }
        
        // ì¢‹ì•„ìš” ì²˜ë¦¬ (Level 4, ì¹´ë“œ)
        function handleLike(toolId) {
            const tool = state.tools.find(t => t.id === toolId);
            if (!tool) return;
            
            const isLiked = state.likedTools.has(toolId);
            if (isLiked) {
                state.likedTools.delete(toolId);
                tool.likes = Math.max(0, (tool.likes || 0) - 1);
            } else {
                state.likedTools.add(toolId);
                tool.likes = (tool.likes || 0) + 1;
            }
            
            localStorage.setItem('likedTools', JSON.stringify(Array.from(state.likedTools)));
            render();
        }
        
        function handleDetailLike(toolId) {
            handleLike(toolId);
            // ìƒì„¸ í˜ì´ì§€ì—ì„œëŠ” ì¢‹ì•„ìš” ë²„íŠ¼ë§Œ ë‹¤ì‹œ ë Œë”ë§í•˜ì—¬ ê¹œë¹¡ì„ ë°©ì§€
            const likeButton = document.getElementById('detailLikeButton');
            const tool = state.tools.find(t => t.id === toolId);
            if (likeButton && tool) {
                const isLiked = state.likedTools.has(toolId);
                likeButton.style.color = isLiked ? '#ef4444' : '#6b7280';
                likeButton.querySelector('svg').setAttribute('fill', isLiked ? 'currentColor' : 'none');
                likeButton.querySelector('span').textContent = tool.likes;
            }
        }
        
        // í•œê¸€ ì…ë ¥ ì¤‘ì¸ì§€ ì¶”ì í•˜ëŠ” ë³€ìˆ˜
        let isComposing = false;
        // ê²€ìƒ‰ ë””ë°”ìš´ìŠ¤ íƒ€ì´ë¨¸
        let searchDebounceTimer = null;
        
        // ê²€ìƒ‰ í•„í„° (ê²€ìƒ‰ ê²°ê³¼ë§Œ ì—…ë°ì´íŠ¸, ì…ë ¥ í•„ë“œëŠ” ìœ ì§€)
        function setSearchQuery(query) {
            state.searchQuery = query;
            state.selectedCategory = 'ì „ì²´';
            state.selectedSubMenu = 'ìœ í˜• ë³´ê¸°'; // ê²€ìƒ‰ ì‹œ ì„œë¸Œ ë©”ë‰´ë„ ì´ˆê¸°í™”
            state.currentPageNum = 1;
            updateSearchResultsOnly();
        }
        
        // ê²€ìƒ‰ ê²°ê³¼ ì˜ì—­ë§Œ ì—…ë°ì´íŠ¸ (ì…ë ¥ í•„ë“œëŠ” ì ˆëŒ€ ì¬ìƒì„±í•˜ì§€ ì•ŠìŒ)
        function updateSearchResultsOnly() {
            if (state.currentPage !== 'home') return;
            
            // ê²€ìƒ‰ ê²°ê³¼ ì˜ì—­ë§Œ ì—…ë°ì´íŠ¸
            // ë©”ì¸ ì¹´í…Œê³ ë¦¬ ë©”ë‰´ëŠ” main > .category-menuë¡œ ì°¾ê¸°
            const main = document.querySelector('main.container');
            const categoryMenu = main ? main.querySelector('.category-menu:first-of-type') : document.querySelector('.category-menu');
            const subMenuContainer = document.querySelector('[data-submenu-container]');
            const contentListContainer = document.querySelector('[data-content-list]');
            
            if (!contentListContainer) {
                // ì»¨í…Œì´ë„ˆê°€ ì—†ìœ¼ë©´ ì „ì²´ ë Œë”ë§
                const app = document.getElementById('app');
                app.innerHTML = renderHome();
                attachEventListeners();
                return;
            }
            
            // í•„í„°ë§ ë° ì •ë ¬
            const filtered = filterAndSortTools(state.tools, { 
                category: state.selectedCategory, 
                searchQuery: state.searchQuery, 
                sortBy: state.sortBy 
            });
            const paginated = paginateTools(filtered, state.currentPageNum, state.ITEMS_PER_PAGE);
            const totalPages = getTotalPages(filtered.length, state.ITEMS_PER_PAGE);
            
            const isSubjectSelected = state.selectedCategory !== 'ì „ì²´' && state.searchQuery === '';
            
            // ì¹´í…Œê³ ë¦¬ ë©”ë‰´ ì—…ë°ì´íŠ¸
            if (categoryMenu) {
                categoryMenu.innerHTML = categories.map(cat => `
                    <button class="menu-item ${state.selectedCategory === cat ? 'active' : ''} body-text" onclick="setCategory('${cat}')">${cat}</button>
                `).join('');
            }
            
            // ì„œë¸Œ ë©”ë‰´ ì—…ë°ì´íŠ¸
            if (subMenuContainer) {
                if (isSubjectSelected) {
                    subMenuContainer.innerHTML = `
                        <div style="margin-top: 1.5rem; display: flex; justify-content: center; width: 100%;">
                            <div class="category-menu" style="max-width: 500px;">
                                <button class="menu-item ${state.selectedSubMenu === 'ìœ í˜• ë³´ê¸°' ? 'active' : ''} body-text" 
                                        onclick="setSubMenu('ìœ í˜• ë³´ê¸°')">ìœ í˜• ë³´ê¸°</button>
                                <button class="menu-item ${state.selectedSubMenu === 'ë¸Œëœë“œ' ? 'active' : ''} body-text" 
                                        onclick="setSubMenu('ë¸Œëœë“œ')">${state.selectedCategory} ë¸Œëœë“œ</button>
                            </div>
                        </div>
                    `;
                    subMenuContainer.style.display = 'block';
                } else {
                    subMenuContainer.style.display = 'none';
                }
            }
            
            // ì½˜í…ì¸  ë¦¬ìŠ¤íŠ¸ ì—…ë°ì´íŠ¸
            if (contentListContainer) {
                if (isSubjectSelected && state.selectedSubMenu === 'ë¸Œëœë“œ') {
                    contentListContainer.innerHTML = `
                        <div style="margin-top: 3rem; text-align: center; padding: 4rem 2rem; background: rgba(106, 113, 246, 0.05); border-radius: 1rem; border: 1px solid rgba(106, 113, 246, 0.2); backdrop-filter: blur(5px);">
                            <h2 style="font-size: 1.5rem; font-weight: bold; color: #6a71f6; margin-bottom: 0.5rem;">${state.selectedCategory} ë¸Œëœë“œ ì½˜í…ì¸  ì˜ì—­</h2>
                            <p class="body-text" style="color: #6b7280;">ì´ê³³ì€ **${state.selectedCategory}** ê³¼ëª©ì— íŠ¹í™”ëœ ë¹„ìƒ êµìœ¡ì˜ ë¸Œëœë“œë³„ ì½˜í…ì¸  ëª©ë¡ì„ í‘œì‹œí•˜ëŠ” ì˜ì—­ì…ë‹ˆë‹¤.</p>
                            <p style="font-size: 0.875rem; color: #9ca3af; margin-top: 1rem;">(í˜„ì¬ ì‹œë®¬ë ˆì´ì…˜ í™”ë©´ì…ë‹ˆë‹¤.)</p>
                        </div>
                    `;
                } else {
                    if (paginated.length > 0) {
                        // ê²€ìƒ‰ ì¤‘ì¸ì§€ í™•ì¸
                        const isSearching = state.searchQuery && state.searchQuery.trim();
                        const titleText = isSearching 
                            ? `"${state.searchQuery}" ê²€ìƒ‰ ê²°ê³¼ (${filtered.length}ê°œ)`
                            : (state.selectedCategory === 'ì „ì²´' ? 'ì¶”ì²œ ê°œë°œ ë°©ì‹' : state.selectedCategory + ' ');
                        const descriptionText = isSearching
                            ? `ê²€ìƒ‰ì–´ "${state.searchQuery}"ì— ëŒ€í•œ ê²°ê³¼ì…ë‹ˆë‹¤.`
                            : 'ìœ í˜•ë³„ ì¹´ë“œë¥¼ í´ë¦­í•˜ì—¬ ê°œë°œ ë°©ì‹ì„ í™•ì¸í•˜ê³  ê±°ë˜í•´ë³´ì„¸ìš”.';
                        
                        contentListContainer.innerHTML = `
                            <div style="margin-top: 3rem; margin-bottom: 2rem;">
                                <h2 style="font-size: 1.75rem; font-weight: bold; color: #2b2b2b;">${titleText}</h2>
                                <p class="body-text" style="color: #6b7280; margin-top: 0.25rem;">${descriptionText}</p>
                            </div>
                            <div class="grid" id="toolGridContainer">
                                ${paginated.map(tool => {
                                    const isLiked = state.likedTools.has(tool.id);
                                    return `
                                    <div class="tool-card" onclick="navigate('detail', ${tool.id})">
                                        <div style="display: flex; justify-content: space-between; align-items: start; margin-bottom: 1rem;">
                                            <div style="display: flex; gap: 0.5rem; flex-wrap: wrap;">
                                                <span class="badge badge-subject">${tool.category}</span>
                                                <span class="badge badge-type body-text">${tool.level2Type}</span> </div>
                                            <span style="font-size: 0.875rem; color: #6b7280;">${tool.aiModel}</span>
                                        </div>
                                        <h3 style="font-size: 1.25rem; font-weight: bold; color: #111827; margin-bottom: 0.5rem;">${tool.title}</h3>
                                        <p style="color: #6b7280; font-size: 0.875rem; margin-bottom: 1rem; display: -webkit-box; -webkit-line-clamp: 2; -webkit-box-orient: vertical; overflow: hidden;">${tool.description}</p>
                                        <div style="display: flex; justify-content: space-between; align-items: center; padding-top: 1rem; border-top: 1px solid #e5e7eb; font-size: 0.875rem; color: #6b7280;">
                                            <button onclick="event.stopPropagation(); handleLike(${tool.id})" class="like-btn-card" style="background: none; border: none; cursor: pointer; display: flex; align-items: center; gap: 0.25rem; transition: color 0.2s; color: ${isLiked ? '#ef4444' : '#6b7280'};">
                                                <svg width="16" height="16" fill="${isLiked ? 'currentColor' : 'none'}" stroke="currentColor" viewBox="0 0 24 24">
                                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4.318 6.318a4.5 4.5 0 000 6.364L12 20.364l7.682-7.682a4.5 4.5 0 00-6.364-6.364L12 7.636l-1.318-1.318a4.5 4.5 0 00-6.364 0z"></path>
                                                </svg>
                                                <span>${tool.likes}</span>
                                            </button>
                                            <div style="display: flex; align-items: center; gap: 1rem;">
                                                <div style="display: flex; align-items: center; gap: 0.25rem;">
                                                    <span style="font-weight: bold; color: #6a71f6;">${tool.coinPrice.toLocaleString()}</span> ì½”ì¸
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    `;
                                }).join('')}
                            </div>
                            ${totalPages > 1 ? `
                            <div id="paginationContainer" style="margin-top: 2rem; display: flex; justify-content: center; align-items: center; gap: 0.5rem;">
                                <span style="margin-left: 1rem; font-size: 0.875rem; color: #6b7280;">${state.currentPageNum} / ${totalPages} í˜ì´ì§€</span>
                            </div>
                            ` : ''}
                        `;
                    } else {
                        // ê²€ìƒ‰ ì¤‘ì¸ì§€ í™•ì¸
                        const isSearching = state.searchQuery && state.searchQuery.trim();
                        const noResultMessage = isSearching
                            ? `"${state.searchQuery}"ì— ëŒ€í•œ ê²€ìƒ‰ ê²°ê³¼ê°€ ì—†ìŠµë‹ˆë‹¤. ë‹¤ë¥¸ ê²€ìƒ‰ì–´ë¥¼ ì‹œë„í•´ë³´ì„¸ìš”.`
                            : 'í•´ë‹¹ ì¡°ê±´ì— ë§ëŠ” ê°œë°œ ë°©ì‹ì´ ì—†ìŠµë‹ˆë‹¤.';
                        contentListContainer.innerHTML = `<div style="text-align: center; padding: 4rem 0;"><p class="body-text" style="color: #6b7280;">${noResultMessage}</p></div>`;
                    }
                }
            }
            
            attachEventListeners();
        }
        
        // ê²€ìƒ‰ ì…ë ¥ í•„ë“œ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì—°ê²°
        function attachSearchInputListeners() {
            const searchInput = document.getElementById('searchInput');
            if (!searchInput) return;
            
            // ê¸°ì¡´ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆê°€ ì´ë¯¸ ì—°ê²°ë˜ì–´ ìˆìœ¼ë©´ ìŠ¤í‚µ
            if (searchInput.dataset.listenersAttached === 'true') return;
            
            // ìƒˆ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì—°ê²°
            searchInput.addEventListener('input', handleSearchInput);
            searchInput.addEventListener('compositionstart', handleCompositionStart);
            searchInput.addEventListener('compositionend', handleCompositionEnd);
            
            // ë¦¬ìŠ¤ë„ˆ ì—°ê²° í‘œì‹œ
            searchInput.dataset.listenersAttached = 'true';
        }
        
        // ê²€ìƒ‰ ì…ë ¥ í•¸ë“¤ëŸ¬
        function handleSearchInput(event) {
            const input = event.target;
            const value = input.value;
            
            // í•œê¸€ ì…ë ¥ ì¤‘ì´ ì•„ë‹ˆë©´ ê²€ìƒ‰ ì‹¤í–‰ (ë””ë°”ìš´ì‹±)
            if (!isComposing) {
                // ë””ë°”ìš´ìŠ¤: ì…ë ¥ì´ ë©ˆì¶˜ í›„ 300ms í›„ì— ê²€ìƒ‰ ì‹¤í–‰
                if (searchDebounceTimer) {
                    clearTimeout(searchDebounceTimer);
                }
                searchDebounceTimer = setTimeout(() => {
                    setSearchQuery(value);
                }, 300);
            }
        }
        
        // í•œê¸€ ì…ë ¥ ì‹œì‘
        function handleCompositionStart(event) {
            isComposing = true;
        }
        
        // í•œê¸€ ì…ë ¥ ì™„ë£Œ
        function handleCompositionEnd(event) {
            isComposing = false;
            // ì…ë ¥ ì™„ë£Œ í›„ ë””ë°”ìš´ì‹±ì„ ì‚¬ìš©í•˜ì—¬ ê²€ìƒ‰ ì‹¤í–‰ (ì…ë ¥ì´ ì™„ì „íˆ ëë‚œ í›„)
            const input = event.target;
            if (searchDebounceTimer) {
                clearTimeout(searchDebounceTimer);
            }
            // í•œê¸€ ì…ë ¥ ì™„ë£Œ í›„ì—ë„ ì•½ê°„ì˜ ì§€ì—°ì„ ë‘ì–´ ì…ë ¥ì´ ì™„ì „íˆ ì•ˆì •í™”ëœ í›„ ê²€ìƒ‰
            searchDebounceTimer = setTimeout(() => {
                setSearchQuery(input.value);
            }, 100);
        }

        // ê²€ìƒ‰ ì…ë ¥ í•„ë“œ ìƒíƒœ ì €ì¥
        function saveSearchInputState() {
            const searchInput = document.getElementById('searchInput');
            if (!searchInput) return null;
            
            return {
                value: searchInput.value,
                selectionStart: searchInput.selectionStart || 0,
                selectionEnd: searchInput.selectionEnd || 0,
                hadFocus: document.activeElement === searchInput
            };
        }
        
        // ê²€ìƒ‰ ì…ë ¥ í•„ë“œ ìƒíƒœ ë³µì›
        function restoreSearchInputState(savedState) {
            if (!savedState) return;
            
            const searchInput = document.getElementById('searchInput');
            if (!searchInput) return;
            
            const valueToSet = savedState.value || state.searchQuery;
            searchInput.value = valueToSet;
            const len = valueToSet.length;
            
            // ì»¤ì„œ ìœ„ì¹˜ ë³µì›
            if (savedState.value === valueToSet && savedState.selectionStart > 0) {
                searchInput.setSelectionRange(
                    Math.min(savedState.selectionStart, len),
                    Math.min(savedState.selectionEnd, len)
                );
            } else {
                searchInput.setSelectionRange(len, len);
            }
            
            if (savedState.hadFocus) {
                setTimeout(() => {
                    searchInput.focus();
                }, 0);
            }
            
            attachSearchInputListeners();
        }
        
        // ë Œë”ë§ í•¨ìˆ˜ë“¤
        function render() {
            const app = document.getElementById('app');
            
            // í™ˆ í˜ì´ì§€ì¼ ë•Œë§Œ ê²€ìƒ‰ ì…ë ¥ í•„ë“œ ìƒíƒœ ì €ì¥
            let savedSearchState = null;
            if (state.currentPage === 'home') {
                savedSearchState = saveSearchInputState();
            }
            
            if (state.currentPage === 'home') {
                app.innerHTML = renderHome();
            } else if (state.currentPage === 'detail') {
                app.innerHTML = renderDetail();
            }
            
            // ê²€ìƒ‰ ì…ë ¥ í•„ë“œ ìƒíƒœ ë³µì›
            if (state.currentPage === 'home' && savedSearchState) {
                restoreSearchInputState(savedSearchState);
            }
            
            attachEventListeners();
        }

        function renderHome() {
            // í•„í„°ë§ì€ í•­ìƒ ë©”ì¸ ì¹´í…Œê³ ë¦¬ë¥¼ ê¸°ì¤€ìœ¼ë¡œ ìˆ˜í–‰í•©ë‹ˆë‹¤.
            const filtered = filterAndSortTools(state.tools, { category: state.selectedCategory, searchQuery: state.searchQuery, sortBy: state.sortBy });
            const paginated = paginateTools(filtered, state.currentPageNum, state.ITEMS_PER_PAGE);
            const totalPages = getTotalPages(filtered.length, state.ITEMS_PER_PAGE);

            const isSubjectSelected = state.selectedCategory !== 'ì „ì²´' && state.searchQuery === ''; // ê²€ìƒ‰ ì¤‘ì¼ ë•ŒëŠ” í•˜ìœ„ ë©”ë‰´ í‘œì‹œ ì•ˆí•¨

            // [NEW] í•˜ìœ„ ë©”ë‰´ HTML
            const subMenuHtml = isSubjectSelected ? `
                <div data-submenu-container style="margin-top: 1.5rem; display: flex; justify-content: center; width: 100%;">
                    <div class="category-menu" style="max-width: 500px;">
                        <button class="menu-item ${state.selectedSubMenu === 'ìœ í˜• ë³´ê¸°' ? 'active' : ''} body-text" 
                                onclick="setSubMenu('ìœ í˜• ë³´ê¸°')">ìœ í˜• ë³´ê¸°</button>
                        <button class="menu-item ${state.selectedSubMenu === 'ë¸Œëœë“œ' ? 'active' : ''} body-text" 
                                onclick="setSubMenu('ë¸Œëœë“œ')">${state.selectedCategory} ë¸Œëœë“œ</button>
                    </div>
                </div>
            ` : '<div data-submenu-container style="display: none;"></div>';
            
            // [NEW] ì½˜í…ì¸  ëª©ë¡ HTML (ìœ í˜•ë³„ ì¹´ë“œ ë˜ëŠ” ë¸Œëœë“œ í”Œë ˆì´ìŠ¤í™€ë”)
            let contentListHtml = '';

            if (isSubjectSelected && state.selectedSubMenu === 'ë¸Œëœë“œ') {
                // ë¸Œëœë“œ ë³´ê¸° í”Œë ˆì´ìŠ¤í™€ë”
                contentListHtml = `
                    <div data-content-list style="margin-top: 3rem; text-align: center; padding: 4rem 2rem; background: rgba(106, 113, 246, 0.05); border-radius: 1rem; border: 1px solid rgba(106, 113, 246, 0.2); backdrop-filter: blur(5px);">
                        <h2 style="font-size: 1.5rem; font-weight: bold; color: #6a71f6; margin-bottom: 0.5rem;">${state.selectedCategory} ë¸Œëœë“œ ì½˜í…ì¸  ì˜ì—­</h2>
                        <p class="body-text" style="color: #6b7280;">ì´ê³³ì€ **${state.selectedCategory}** ê³¼ëª©ì— íŠ¹í™”ëœ ë¹„ìƒ êµìœ¡ì˜ ë¸Œëœë“œë³„ ì½˜í…ì¸  ëª©ë¡ì„ í‘œì‹œí•˜ëŠ” ì˜ì—­ì…ë‹ˆë‹¤.</p>
                        <p style="font-size: 0.875rem; color: #9ca3af; margin-top: 1rem;">(í˜„ì¬ ì‹œë®¬ë ˆì´ì…˜ í™”ë©´ì…ë‹ˆë‹¤.)</p>
                    </div>
                `;
            } else {
                // ìœ í˜• ë³´ê¸° (ê¸°ì¡´ ì¹´ë“œ ë¦¬ìŠ¤íŠ¸)
                if (paginated.length > 0) {
                    // ê²€ìƒ‰ ì¤‘ì¸ì§€ í™•ì¸
                    const isSearching = state.searchQuery && state.searchQuery.trim();
                    const titleText = isSearching 
                        ? `"${state.searchQuery}" ê²€ìƒ‰ ê²°ê³¼ (${filtered.length}ê°œ)`
                        : (state.selectedCategory === 'ì „ì²´' ? 'ì¶”ì²œ ê°œë°œ ë°©ì‹' : state.selectedCategory + ' ');
                    const descriptionText = isSearching
                        ? `ê²€ìƒ‰ì–´ "${state.searchQuery}"ì— ëŒ€í•œ ê²°ê³¼ì…ë‹ˆë‹¤.`
                        : 'ìœ í˜•ë³„ ì¹´ë“œë¥¼ í´ë¦­í•˜ì—¬ ê°œë°œ ë°©ì‹ì„ í™•ì¸í•˜ê³  ê±°ë˜í•´ë³´ì„¸ìš”.';
                    
                    contentListHtml = `
                    <div data-content-list>
                        <div style="margin-top: 3rem; margin-bottom: 2rem;">
                            <h2 style="font-size: 1.75rem; font-weight: bold; color: #2b2b2b;">${titleText}</h2>
                            <p class="body-text" style="color: #6b7280; margin-top: 0.25rem;">${descriptionText}</p>
                        </div>
                        <div class="grid" id="toolGridContainer">
                            ${paginated.map(tool => {
                                const isLiked = state.likedTools.has(tool.id);
                                return `
                                <div class="tool-card" onclick="navigate('detail', ${tool.id})">
                                    <div style="display: flex; justify-content: space-between; align-items: start; margin-bottom: 1rem;">
                                        <div style="display: flex; gap: 0.5rem; flex-wrap: wrap;">
                                            <span class="badge badge-subject">${tool.category}</span>
                                            <span class="badge badge-type body-text">${tool.level2Type}</span> </div>
                                        <span style="font-size: 0.875rem; color: #6b7280;">${tool.aiModel}</span>
                                    </div>
                                    <h3 style="font-size: 1.25rem; font-weight: bold; color: #111827; margin-bottom: 0.5rem;">${tool.title}</h3>
                                    <p style="color: #6b7280; font-size: 0.875rem; margin-bottom: 1rem; display: -webkit-box; -webkit-line-clamp: 2; -webkit-box-orient: vertical; overflow: hidden;">${tool.description}</p>
                                    <div style="display: flex; justify-content: space-between; align-items: center; padding-top: 1rem; border-top: 1px solid #e5e7eb; font-size: 0.875rem; color: #6b7280;">
                                        <button onclick="event.stopPropagation(); handleLike(${tool.id})" class="like-btn-card" style="background: none; border: none; cursor: pointer; display: flex; align-items: center; gap: 0.25rem; transition: color 0.2s; color: ${isLiked ? '#ef4444' : '#6b7280'};">
                                            <svg width="16" height="16" fill="${isLiked ? 'currentColor' : 'none'}" stroke="currentColor" viewBox="0 0 24 24">
                                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4.318 6.318a4.5 4.5 0 000 6.364L12 20.364l7.682-7.682a4.5 4.5 0 00-6.364-6.364L12 7.636l-1.318-1.318a4.5 4.5 0 00-6.364 0z"></path>
                                            </svg>
                                            <span>${tool.likes}</span>
                                        </button>
                                        <div style="display: flex; align-items: center; gap: 1rem;">
                                            <div style="display: flex; align-items: center; gap: 0.25rem;">
                                                <span style="font-weight: bold; color: #6a71f6;">${tool.coinPrice.toLocaleString()}</span> ì½”ì¸
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                `;
                            }).join('')}
                        </div>
                        ${totalPages > 1 ? `
                        <div id="paginationContainer" style="margin-top: 2rem; display: flex; justify-content: center; align-items: center; gap: 0.5rem;">
                            <span style="margin-left: 1rem; font-size: 0.875rem; color: #6b7280;">${state.currentPageNum} / ${totalPages} í˜ì´ì§€</span>
                        </div>
                        ` : ''}
                    </div>
                    `;
                } else {
                    // ê²€ìƒ‰ ì¤‘ì¸ì§€ í™•ì¸
                    const isSearching = state.searchQuery && state.searchQuery.trim();
                    const noResultMessage = isSearching
                        ? `"${state.searchQuery}"ì— ëŒ€í•œ ê²€ìƒ‰ ê²°ê³¼ê°€ ì—†ìŠµë‹ˆë‹¤. ë‹¤ë¥¸ ê²€ìƒ‰ì–´ë¥¼ ì‹œë„í•´ë³´ì„¸ìš”.`
                        : 'í•´ë‹¹ ì¡°ê±´ì— ë§ëŠ” ê°œë°œ ë°©ì‹ì´ ì—†ìŠµë‹ˆë‹¤.';
                    contentListHtml = `<div data-content-list style="text-align: center; padding: 4rem 0;"><p class="body-text" style="color: #6b7280;">${noResultMessage}</p></div>`;
                }
            }


            return `
            <header>
                <div class="header-content">
                    <div class="logo" onclick="navigate('home')">Visang Market</div>
                    <div style="display: flex; gap: 0.5rem;">
                        <button class="btn btn-secondary" onclick="showToast('ê¸°ëŠ¥ ì‹œë®¬ë ˆì´ì…˜', 'ê°œì¸ ë³´ìœ  ì½”ì¸ í™•ì¸ í˜ì´ì§€ë¡œ ì´ë™í•©ë‹ˆë‹¤.', 'info')">ğŸ’° ë‚´ ì½”ì¸</button>
                        <button class="btn btn-primary" onclick="showToast('ê¸°ëŠ¥ ì‹œë®¬ë ˆì´ì…˜', 'ê°œë°œ ë°©ì‹ ë“±ë¡ í˜ì´ì§€ë¡œ ì´ë™í•©ë‹ˆë‹¤.', 'success')">ë“±ë¡í•˜ê¸°</button>
                    </div>
                </div>
            </header>
            <main class="container" style="padding-top: 2rem;">
                <div class="search-card" style="margin-bottom: 2rem;">
                    <div class="hero-title" style="margin-bottom: 1rem; text-align: center;">
                        <span style="background: linear-gradient(to right, #00b5e2, #6a71f6); -webkit-background-clip: text; -webkit-text-fill-color: transparent;">Visang Market</span>
                    </div>
                    <div style="display: flex; gap: 1rem; align-items: center;">
                        <div class="search-input-wrapper" style="flex: 1;">
                            <svg class="search-icon" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path> 
                            </svg>
                            <input type="text" id="searchInput" class="search-input body-text" placeholder="ê²€ìƒ‰: ê°ê´€ì‹, ì„œìˆ í˜•, AI, ì˜ì–´ ë“±" value="${state.searchQuery}" style="border-radius: 9999px; padding-left: 3rem;">
                        </div>
                    </div>
                </div>
                <div class="category-menu" style="margin-bottom: 1rem;">
                    ${categories.map(cat => `
                        <button class="menu-item ${state.selectedCategory === cat ? 'active' : ''} body-text" onclick="setCategory('${cat}')">${cat}</button>
                    `).join('')}
                </div>
                
                ${subMenuHtml}
                
                ${contentListHtml}

            </main>
            `;
        }

        // ë ˆë²¨ 4 (ìƒì„¸ ë¶„ë¥˜ì˜ íŒì—… í™”ë©´) ë Œë”ë§
        function renderDetail() {
            const tool = state.tools.find(t => t.id === state.currentToolId);
            if (!tool) {
                return `<div class="container" style="padding-top: 2rem;">ê°œë°œ ë°©ì‹ì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.</div>`;
            }
            const isLiked = state.likedTools.has(tool.id);

            return `
            <header>
                <div class="header-content">
                    <button class="btn btn-secondary body-text" onclick="navigate('home')">â† ëª©ë¡ìœ¼ë¡œ</button>
                    <div class="logo" onclick="navigate('home')">Visang Market</div>
                    <button class="btn btn-secondary body-text" onclick="showToast('ê¸°ëŠ¥ ì‹œë®¬ë ˆì´ì…˜', 'ê³µìœ í•˜ê¸° ê¸°ëŠ¥ì´ ì‹¤í–‰ë©ë‹ˆë‹¤.', 'info')">ê³µìœ í•˜ê¸°</button>
                </div>
            </header>
            <main class="container" style="padding-top: 3rem; padding-bottom: 5rem;">
                <div style="display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 1rem;">
                    <div style="display: flex; gap: 0.5rem; flex-wrap: wrap;">
                        <span class="badge badge-subject body-text">${tool.category}</span>
                        <span class="badge badge-type body-text">${tool.level2Type}</span>
                    </div>
                    <span style="color: #6b7280; font-size: 0.875rem;">ì¡°íšŒìˆ˜ ${tool.views} Â· ë“±ë¡ì¼ ${tool.createdAt}</span>
                </div>
                
                <h1 style="font-size: 2rem; margin-bottom: 0.5rem;">${tool.title}</h1>
                <div style="font-size: 1rem; color: #6b7280; margin-bottom: 2rem;">
                    ì œì‘ ë°©ì‹: <span style="font-weight: 600;">${tool.productionMethod}</span>
                </div>
                
                <div style="margin-bottom: 3rem; padding: 1.5rem; background: rgba(0, 181, 226, 0.05); border-radius: 1rem; display: flex; flex-direction: column; align-items: stretch; border: 1px solid rgba(0, 181, 226, 0.2); gap: 1rem;">
                    <div style="display: flex; justify-content: space-between; align-items: center;">
                        <div class="body-text" style="font-weight: bold; color: #2b2b2b;">
                            ğŸ’° ê°œë°œ ë°©ì‹ ê±°ë˜ê°€: <span style="font-size: 1.5rem; color: #6a71f6;">${tool.coinPrice.toLocaleString()}</span> ì½”ì¸
                        </div>
                        <button id="detailLikeButton" onclick="handleDetailLike(${tool.id})" class="like-btn-detail body-text" style="background: none; border: none; cursor: pointer; display: flex; align-items: center; gap: 0.5rem; transition: color 0.2s; color: ${isLiked ? '#ef4444' : '#6b7280'};">
                            <svg width="24" height="24" fill="${isLiked ? 'currentColor' : 'none'}" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4.318 6.318a4.5 4.5 0 000 6.364L12 20.364l7.682-7.682a4.5 4.5 0 00-6.364-6.364L12 7.636l-1.318-1.318a4.5 4.5 0 00-6.364 0z"></path>
                            </svg>
                            <span style="font-weight: bold;">${tool.likes}</span>
                        </button>
                    </div>
                    <div style="display: flex; gap: 1rem;">
                        <button class="btn btn-primary body-text" style="flex: 2; background: linear-gradient(to right, #6a71f6, #00b5e2); box-shadow: 0 4px 10px rgba(106, 113, 246, 0.3);" onclick="showToast('ì½”ì¸ ê±°ë˜ ì‹œë®¬ë ˆì´ì…˜', 'ê°œë°œ ë°©ì‹ êµ¬ë§¤ë¥¼ ìœ„í•œ ì½”ì¸ ${tool.coinPrice.toLocaleString()}ê°œê°€ ì°¨ê°ë˜ì—ˆìŠµë‹ˆë‹¤.', 'success');">
                            ğŸ’° ì½”ì¸ìœ¼ë¡œ ê±°ë˜í•˜ê¸°
                        </button>
                        <button class="btn btn-secondary body-text" style="flex: 1;" onclick="showToast('ì±„íŒ… ê¸°ëŠ¥ ì‹œë®¬ë ˆì´ì…˜', 'ê°œë°œ ë°©ì‹ ë“±ë¡ì(${tool.aiModel || 'ìµëª… ì „ë¬¸ê°€'})ì™€ 1:1 ì±„íŒ…ì„ ì‹œì‘í•©ë‹ˆë‹¤.', 'info');">
                            ğŸ’¬ ê°œë³„ ì±„íŒ…
                        </button>
                    </div>
                </div>

                <div class="card" style="margin-bottom: 3rem;">
                    <h2 style="font-size: 1.75rem; font-weight: bold; color: #00b5e2; margin-bottom: 1rem;">ğŸ’¡í•µì‹¬ í¬ì¸íŠ¸</h2>
                    <p class="body-text" style="line-height: 1.8; color: #374151;">${tool.longDescription || tool.description}</p>
                </div>
                
                <div class="card" style="margin-top: 2rem;">
                    <h2 style="font-size: 1.75rem; font-weight: bold; color: #2b2b2b; margin-bottom: 1.5rem;">ğŸ’¡ê°œë°œ ì„¸ë¶€ ì •ë³´</h2>
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 1rem; font-size: 1.125rem;">
                        <div style="background: rgba(0, 181, 226, 0.05); border-radius: 0.75rem; padding: 1rem; border: 1px solid rgba(0, 181, 226, 0.2); backdrop-filter: blur(5px);">
                            <p style="font-weight: bold; color: #00b5e2; margin-bottom: 0.25rem; font-size: 1rem;">ì œì‘ ë°©ì‹</p>
                            <p class="body-text" style="font-weight: 500;">${tool.productionMethod}</p>
                        </div>
                        <div style="background: rgba(0, 181, 226, 0.05); border-radius: 0.75rem; padding: 1rem; border: 1px solid rgba(0, 181, 226, 0.2); backdrop-filter: blur(5px);">
                            <p style="font-weight: bold; color: #00b5e2; margin-bottom: 0.25rem; font-size: 1rem;">ì œì‘ ì‹œ í•„ìš” ë¦¬ì†ŒìŠ¤</p>
                            <p class="body-text" style="font-weight: 500;">${tool.requiredResource}</p>
                        </div>
                        <div style="background: rgba(0, 181, 226, 0.05); border-radius: 0.75rem; padding: 1rem; border: 1px solid rgba(0, 181, 226, 0.2); backdrop-filter: blur(5px);">
                            <p style="font-weight: bold; color: #00b5e2; margin-bottom: 0.25rem; font-size: 1rem;">ì œì‘ ì†Œìš” ì‹œê°„</p>
                            <p class="body-text" style="font-weight: 500;">${tool.timeSpent}</p>
                        </div>
                        <div style="background: rgba(0, 181, 226, 0.05); border-radius: 0.75rem; padding: 1rem; border: 1px solid rgba(0, 181, 226, 0.2); backdrop-filter: blur(5px);">
                            <p style="font-weight: bold; color: #00b5e2; margin-bottom: 0.25rem; font-size: 1rem;">ì•„ë˜ ê³¼ëª©ì— ì¶”ì²œí•´ìš”</p>
                            <p class="body-text" style="font-weight: 500;">${tool.recommendedSubject}</p>
                        </div>
                    </div>
                </div>

                <div style="margin-top: 3rem;">
                    <h2 style="font-size: 1.75rem; font-weight: bold; color: #2b2b2b; margin-bottom: 1.5rem;">ğŸ“ì‚¬ìš©ì ë¦¬ë·° </h2>
                    <p class="body-text" style="color: #6b7280;">ì´ ê°œë°œ ë°©ì‹ì„ ì‚¬ìš©í•´ ë³¸ í›„ê¸°ë¥¼ ë‚¨ê²¨ì£¼ì„¸ìš”.</p>
                </div>
                <div id="commentsSection" style="margin-top: 1rem;">
                    <div class="card body-text" style="margin-bottom: 1rem;">
                        <p style="font-weight: bold; color: #6a71f6;">ê¹€**</p>
                        <p>ê°ê´€ì‹ ë¬¸ì œ ì œì‘ ì‹œê°„ì´ íšê¸°ì ìœ¼ë¡œ ì¤„ì—ˆìŠµë‹ˆë‹¤. ì½”ì¸ ê±°ë˜ ê°€ì¹˜ê°€ ì¶©ë¶„í•©ë‹ˆë‹¤!</p>
                        <span style="font-size: 0.875rem; color: #9ca3af;">2024.11.20</span>
                    </div>
                    <div class="card body-text">
                        <p style="font-weight: bold; color: #6a71f6;">ì´**</p>
                        <p>í¼ì¦í˜• ì½˜í…ì¸  ì œì‘ ê°€ì´ë“œê°€ êµ¬ì²´ì ì´ì–´ì„œ ë¹„ê°œë°œìë„ ì‰½ê²Œ ë”°ë¼ í•  ìˆ˜ ìˆì—ˆì–´ìš”.</p>
                        <span style="font-size: 0.875rem; color: #9ca3af;">2024.11.25</span>
                    </div>
                    </div>
            </main>
            `;
        }

        function attachEventListeners() {
            // ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ë¶€ì°© ë¡œì§ (í˜„ì¬ëŠ” ì „ì—­ í•¨ìˆ˜ë¡œ ì²˜ë¦¬)
            // ê²€ìƒ‰ ì…ë ¥ í•„ë“œ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì—°ê²°
            attachSearchInputListeners();
        }
        
        // ì´ˆê¸°í™”
        async function init() {
            // ê¸°ì¡´ í…œí”Œë¦¿ì˜ ì¢‹ì•„ìš” ìƒíƒœ ë¡œë“œ ë¡œì§
            const stored = localStorage.getItem('likedTools');
            if (stored) {
                try {
                    state.likedTools = new Set(JSON.parse(stored));
                } catch (e) {}
            }
            render();
        }
        
        // ì „ì—­ í•¨ìˆ˜ë¡œ ë…¸ì¶œ
        window.navigate = navigate;
        window.setCategory = setCategory;
        window.setSubMenu = setSubMenu; // [NEW] setSubMenu ë…¸ì¶œ
        window.changePage = changePage;
        window.handleLike = handleLike;
        window.handleDetailLike = handleDetailLike;
        window.setSearchQuery = setSearchQuery;

        init();
        
    </script>
    
</body>
</html>
